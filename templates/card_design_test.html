<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <a href="{{ url_for('home') }}" class="back-button">
                <i class="fas fa-arrow-right"></i>
            </a>
            <h1>Ø§Ø®ØªØ¨Ø§Ø± ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h1>
        </header>
        
        <main>
            <!-- Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
            <div class="card-type-selector">
                <label for="cardTypeSelect">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
                <select id="cardTypeSelect" onchange="updateCardDesign()">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© --</option>
                    {% for product in product_types %}
                    <option value="{{ product.name }}" 
                            data-id="{{ product.id }}"
                            data-price="{{ product.price }}"
                            data-color="{{ product.background_color }}" 
                            data-background-image="{{ product.background_image or '' }}"
                            data-logo="{{ product.logo_image or '' }}"
                            data-display="{{ product.display_name }}">
                        {{ product.display_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© -->
            <div class="selected-card-info" id="selectedCardInfo" style="display: none;">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</h3>
                <div class="card-details">
                    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</strong> <span id="selectedCardName">-</span></p>
                    <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> <span id="selectedCardPrice">-</span> Ø±ÙŠØ§Ù„</p>
                    <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</strong> <span id="selectedCardId">-</span></p>
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ÙƒÙˆØ¯ -->
            <div class="code-method-info" style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
                <h4 style="margin: 0 0 10px 0; color: #1976D2;">ğŸ”§ Ø·Ø±ÙŠÙ‚Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                <p style="margin: 0; color: #555;">
                    {% if code_method == 'system' %}
                        <strong>Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙƒÙˆØ§Ø¯ Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø³Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    {% else %}
                        <strong>Ø£ÙƒÙˆØ§Ø¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©:</strong> Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø©
                    {% endif %}
                </p>
                <small style="color: #666;">ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© > Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</small>
            </div>

            <!-- Ù‚Ø³Ù… Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
            <div class="card-preview-section">
                <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h3>
                <div class="gift-card" id="previewCard" data-type="Ø¹Ø§Ù…">
                    <div class="card-content">
                        <div class="card-logo">
                            <img id="cardLogo" src="" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" class="logo-image">
                        </div>
                        <div class="to-section">
                            <span class="to-label" style="font-size: 12px;">Ø¥Ù„Ù‰</span>
                            <span class="to-name " style="font-size: 12px;"  id="toName">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</span>
                        </div>
                        
                        <div class="card-message" id="cardMessage">
                            ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†Øª Ø¨Ø®ÙŠØ±! Ø£ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø¹Ø§Ù…Ø§Ù‹ Ù…Ù„ÙŠØ¦Ø§Ù‹ Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ÙˆØ§Ù„Ù†Ø¬Ø§Ø­.
                        </div>
                        
                        <div class="from-section">
                            <span class="from-label"  style="font-size: 12px;">Ù…Ù†:</span>
                            <span class="from-name" style="font-size: 12px;" id="fromName">Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯</span>
                        </div>
                        
                        <div class="card-code">
                            <span id="randomCode">789456</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… ØªØ®ØµÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <div class="card-customization">
                <h3>ØªØ®ØµÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div class="form-group">
                    <label for="toNameInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…:</label>
                    <input type="text" id="toNameInput" value="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" onchange="updateCardData()">
                </div>
                <div class="form-group">
                    <label for="fromNameInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„:</label>
                    <input type="text" id="fromNameInput" value="Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯" onchange="updateCardData()">
                </div>
                <div class="form-group">
                    <label for="messageInput">Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                    <textarea id="messageInput" onchange="updateCardData()">ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†Øª Ø¨Ø®ÙŠØ±! Ø£ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø¹Ø§Ù…Ø§Ù‹ Ù…Ù„ÙŠØ¦Ø§Ù‹ Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ÙˆØ§Ù„Ù†Ø¬Ø§Ø­.</textarea>
                </div>
                <div class="form-group">
                    <label for="codeInput">Ø±Ù…Ø² Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
                    <input type="text" id="codeInput" value="789456" onchange="updateCardData()">
                </div>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
            <div class="card-actions">
                <button class="btn-secondary" onclick="downloadCard()">
                    <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                </button>
                <button class="btn-primary" onclick="shareCard()">
                    <i class="fas fa-share-alt"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                </button>
            </div>
        </main>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª -->
        <nav class="bottom-navbar">
            <div class="nav-item" onclick="window.location.href='{{ url_for('home') }}';"> 
                <i class="fas fa-home"></i>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </div>
            <div class="nav-item add-button" onclick="window.location.href='{{ url_for('products') }}';"> 
                <i class="fas fa-plus-circle"></i>
                <span>Ø¥Ø¶Ø§ÙØ©</span>
            </div>
            <div class="nav-item">
                <i class="fas fa-user"></i>
                <span>Ø­Ø³Ø§Ø¨ÙŠ</span>
            </div>
        </nav>
    </div>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        function updateCardDesign() {
            const select = document.getElementById('cardTypeSelect');
            const selectedOption = select.options[select.selectedIndex];
            const previewCard = document.getElementById('previewCard');
            const cardLogo = document.getElementById('cardLogo');
            
            if (selectedOption.value) {
                const cardId = selectedOption.getAttribute('data-id');
                const cardType = selectedOption.value;
                const cardPrice = selectedOption.getAttribute('data-price');
                const backgroundColor = selectedOption.getAttribute('data-color');
                const backgroundImage = selectedOption.getAttribute('data-background-image');
                const logoImage = selectedOption.getAttribute('data-logo');
                const displayName = selectedOption.getAttribute('data-display');
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                previewCard.setAttribute('data-type', cardType);
                previewCard.setAttribute('data-id', cardId);
                previewCard.setAttribute('data-price', cardPrice);
                
                // ØªØ­Ø¯ÙŠØ« Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© - Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
                if (backgroundImage && backgroundImage.trim() !== '') {
                    previewCard.style.backgroundImage = `url('{{ url_for('static', filename='') }}${backgroundImage}')`;
                    previewCard.style.backgroundSize = 'cover';
                    previewCard.style.backgroundPosition = 'center';
                    previewCard.style.backgroundRepeat = 'no-repeat';
                    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©:', backgroundImage);
                } else {
                    // Ø¥Ø²Ø§Ù„Ø© ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ØªÙˆÙØ±Ø©
                    previewCard.style.backgroundImage = '';
                    console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ù„Ù„Ø¹Ø±Ø¶');
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø±
                if (logoImage && logoImage.trim() !== '') {
                    cardLogo.src = `{{ url_for('static', filename='') }}${logoImage}`;
                    cardLogo.style.display = 'block';
                    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø±:', logoImage);
                } else {
                    cardLogo.style.display = 'none';
                    console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ø±Ø¶');
                }
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('selectedCardInfo').style.display = 'block';
                document.getElementById('selectedCardName').textContent = cardType;
                document.getElementById('selectedCardPrice').textContent = cardPrice;
                document.getElementById('selectedCardId').textContent = cardId;
                
                // Ø¬Ù„Ø¨ ÙƒÙˆØ¯ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©
                fetchPreviewCode(cardPrice);
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
                console.log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${displayName} (ID: ${cardId}, Ø§Ù„Ø³Ø¹Ø±: ${cardPrice} Ø±ÙŠØ§Ù„)`);
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… - Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª
                previewCard.style.backgroundImage = '';
                previewCard.removeAttribute('data-id');
                previewCard.removeAttribute('data-price');
                cardLogo.style.display = 'none';
                
                // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                document.getElementById('selectedCardInfo').style.display = 'none';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                document.getElementById('codeInput').value = '789456';
                updateCardData();
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const isPreview = urlParams.get('preview') === 'true';
            
            if (isPreview) {
                // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† sessionStorage
                const fromName = sessionStorage.getItem('previewFromName');
                const toName = sessionStorage.getItem('previewToName');
                const message = sessionStorage.getItem('previewMessage');
                const productId = sessionStorage.getItem('previewProductId');
                
                if (fromName && toName && message && productId) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                    const select = document.getElementById('cardTypeSelect');
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].getAttribute('data-id') === productId) {
                            select.selectedIndex = i;
                            updateCardDesign();
                            break;
                        }
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    document.getElementById('toNameInput').value = toName;
                    document.getElementById('fromNameInput').value = fromName;
                    document.getElementById('messageInput').value = message;
                    updateCardData();
                    
                    // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† sessionStorage
                    sessionStorage.removeItem('previewFromName');
                    sessionStorage.removeItem('previewToName');
                    sessionStorage.removeItem('previewMessage');
                    sessionStorage.removeItem('previewProductId');
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                    const cardTypeSelector = document.querySelector('.card-type-selector');
                    const cardCustomization = document.querySelector('.card-customization');
                    const cardActions = document.querySelector('.card-actions');
                    
                    if (cardTypeSelector) cardTypeSelector.style.display = 'none';
                    if (cardCustomization) cardCustomization.style.display = 'none';
                    if (cardActions) cardActions.style.display = 'none';
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
                    const previewMessage = document.createElement('div');
                    previewMessage.innerHTML = '<h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©</h2>';
                    const mainElement = document.querySelector('main');
                    const cardPreviewSection = document.querySelector('.card-preview-section');
                    if (mainElement && cardPreviewSection) {
                        mainElement.insertBefore(previewMessage, cardPreviewSection);
                    }
                }
            }
        });
        
        function updateCardData() {
            const toName = document.getElementById('toNameInput').value;
            const fromName = document.getElementById('fromNameInput').value;
            const message = document.getElementById('messageInput').value;
            const code = document.getElementById('codeInput').value;
            
            document.getElementById('toName').textContent = toName;
            document.getElementById('fromName').textContent = fromName;
            document.getElementById('cardMessage').textContent = message;
            document.getElementById('randomCode').textContent = code;
        }
        
        function fetchPreviewCode(price) {
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            const codeInput = document.getElementById('codeInput');
            const originalValue = codeInput.value;
            codeInput.value = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            codeInput.disabled = true;
            
            fetch(`/api/get-preview-code/${price}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        codeInput.value = data.code;
                        
                        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ÙƒÙˆØ¯
                        let message = '';
                        switch(data.method) {
                            case 'system':
                                message = 'âœ… ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…';
                                break;
                            case 'random_fallback':
                                message = 'âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ';
                                break;
                            case 'random':
                                message = 'â„¹ï¸ ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)';
                                break;
                            case 'error_fallback':
                                message = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ';
                                break;
                        }
                        
                        // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
                        if (message) {
                            const messageDiv = document.createElement('div');
                            messageDiv.style.cssText = `
                                position: fixed;
                                top: 20px;
                                right: 20px;
                                background: #333;
                                color: white;
                                padding: 10px 15px;
                                border-radius: 5px;
                                z-index: 1000;
                                font-size: 14px;
                                max-width: 300px;
                            `;
                            messageDiv.textContent = message;
                            document.body.appendChild(messageDiv);
                            
                            setTimeout(() => {
                                document.body.removeChild(messageDiv);
                            }, 3000);
                        }
                        
                        console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯:', data);
                    } else {
                        codeInput.value = data.code || originalValue;
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
                    codeInput.value = originalValue;
                })
                .finally(() => {
                    codeInput.disabled = false;
                    updateCardData();
                });
        }
        
        function downloadCard() {
            const cardElement = document.querySelector('.gift-card');
            
            html2canvas(cardElement, {
                backgroundColor: null,
                scale: 2,
                logging: false,
                useCORS: true
            }).then(function(canvas) {
                const dataURL = canvas.toDataURL('image/png');
                
                const downloadLink = document.createElement('a');
                downloadLink.href = dataURL;
                downloadLink.download = 'gift-card-design.png';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            });
        }
        
        function shareCard() {
            if (navigator.share) {
                navigator.share({
                    title: 'Ø¨Ø·Ø§Ù‚Ø© Ø¥Ù‡Ø¯Ø§Ø¡',
                    text: 'Ø´Ø§Ù‡Ø¯ ØªØµÙ…ÙŠÙ… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ù‡Ø°Ù‡',
                    url: window.location.href
                });
            } else {
                // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
                navigator.clipboard.writeText(window.location.href).then(function() {
                    alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
                });
            }
        }
    </script>
    
    <style>
        .card-type-selector {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .selected-card-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .selected-card-info h3 {
            margin: 0 0 15px 0;
            color: #333;
            text-align: center;
        }
        
        .card-details {
            display: grid;
            gap: 10px;
        }
        
        .card-details p {
            margin: 0;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .card-details strong {
            color: #495057;
        }
        
        .card-details span {
            color: #667eea;
            font-weight: 600;
        }
        
        .card-type-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .card-type-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            color: #333;
        }
        
        .card-type-selector select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .card-preview-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card-preview-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            text-align: center;
        }
        
        .card-customization {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card-customization h3 {
            margin: 0 0 20px 0;
            color: #333;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        

    </style>
</body>
</html>